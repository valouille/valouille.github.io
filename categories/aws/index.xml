<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>AWS on VaLouille</title><link>https://valouille.github.io/categories/aws/</link><description>Recent content in AWS on VaLouille</description><generator>Hugo</generator><language>fr</language><copyright>Valérian Beaudoin</copyright><lastBuildDate>Thu, 22 Mar 2018 12:12:08 +0100</lastBuildDate><atom:link href="https://valouille.github.io/categories/aws/index.xml" rel="self" type="application/rss+xml"/><item><title>How to use Terraform to deploy an Application Load-Balancer (ALB) with multiple SSL certificates</title><link>https://valouille.github.io/post/2018-03-22-how-to-use-terraform-to-deploy-an-alb-application-load-balancer-with-multiple-ssl-certificates/</link><pubDate>Thu, 22 Mar 2018 12:12:08 +0100</pubDate><guid>https://valouille.github.io/post/2018-03-22-how-to-use-terraform-to-deploy-an-alb-application-load-balancer-with-multiple-ssl-certificates/</guid><description>The old Elastic Load Balancer (ELB) now known as Classic Load-Balancer currently only supports one SSL certificate. Since October 2017, it&amp;rsquo;s possible to use up to 25 SSL certificates on a single Application Load-Balancer (ALB). The ALB will then use SNI to provide the right SSL certificate depending on the URL accessed.
AWS Provider 1.10.0 is required, included from Terraform 0.11.4, but it&amp;rsquo;s possible to use it with an older Terraform version</description></item><item><title>Récupérer et écrire dans les logs d'accès l'IP source des connexions sur AWS derrière un ELB/ALB avec le header X-Forwarded-For</title><link>https://valouille.github.io/post/2018-03-15-impossible-d-obtenir-l-ip-relle-des-clients-via-le-header-x-forwarded-for-derriere-un-elb/</link><pubDate>Thu, 15 Mar 2018 00:05:08 +0100</pubDate><guid>https://valouille.github.io/post/2018-03-15-impossible-d-obtenir-l-ip-relle-des-clients-via-le-header-x-forwarded-for-derriere-un-elb/</guid><description>Pour récupérer l&amp;rsquo;adresse IP source du client qui initie la connexion au niveau d&amp;rsquo;une instance située derrière un Load-Balancer, plutôt que l&amp;rsquo;IP du Load-Balancer lui-même, il est nécessaire d&amp;rsquo;utiliser un header HTTP spécifique.
Dans AWS, l&amp;rsquo;ELB/ALB ajoute plusieurs headers par défaut, dont X-Forwarded-For, qui correspond à l&amp;rsquo;adresse IP publique à partir de laquelle la connexion est effectuée.
Les headers ne sont ajoutés que lorsqu&amp;rsquo;on utilise un Load-Balancer qui fait du niveau 7, c&amp;rsquo;est à dire un Load-Balancer configuré pour se connecter sur les instances en HTTP et HTTPS, pas en TCP ou SSL (niveau 4).</description></item><item><title>Le réseau dans le cloud AWS</title><link>https://valouille.github.io/2018/03/le-reseau-dans-le-cloud-aws/</link><pubDate>Fri, 02 Mar 2018 20:32:16 +0000</pubDate><guid>https://valouille.github.io/2018/03/le-reseau-dans-le-cloud-aws/</guid><description>Il est nécessaire de bien comprendre plusieurs concepts réseau afin de déployer une application dans le cloud AWS de manière optimale. Comme je n’ai pas trouvé de schéma qui regroupe l’ensemble des concepts, j’ai décidé d’en faire un, afin d’avoir une architecture de référence à utiliser pour décrire ces concepts. Évidemment, étant donné la relative complexité de l’infrastructure, le schéma est assez grand. Vous pouvez cliquer sur l’image pour ouvrir le fichier original.</description></item><item><title>Mettre en place du filtrage IP sur un bucket S3</title><link>https://valouille.github.io/2018/02/mettre-en-place-du-filtrage-ip-sur-un-bucket-s3/</link><pubDate>Wed, 28 Feb 2018 15:20:33 +0000</pubDate><guid>https://valouille.github.io/2018/02/mettre-en-place-du-filtrage-ip-sur-un-bucket-s3/</guid><description>Pour autoriser l’accès à un bucket S3 uniquement à partir de certaines IPs, il faut associer une bucket policy comme celle ci-dessous :
{ &amp;#34;Version&amp;#34;: &amp;#34;2012-10-17&amp;#34;, &amp;#34;Id&amp;#34;: &amp;#34;S3PolicyMyIpFilter&amp;#34;, &amp;#34;Statement&amp;#34;: [ { &amp;#34;Sid&amp;#34;: &amp;#34;IPAllow&amp;#34;, &amp;#34;Effect&amp;#34;: &amp;#34;Allow&amp;#34;, &amp;#34;Principal&amp;#34;: &amp;#34;*&amp;#34;, &amp;#34;Action&amp;#34;: &amp;#34;s3:*&amp;#34;, &amp;#34;Resource&amp;#34;: &amp;#34;arn:aws:s3:::bucket-name/*&amp;#34;, &amp;#34;Condition&amp;#34;: { &amp;#34;IpAddress&amp;#34;: { &amp;#34;aws:SourceIp&amp;#34;: [ &amp;#34;123.56.78.9/32&amp;#34;, &amp;#34;98.76.54.32/32&amp;#34; ] } } } ] } Il faut adapter le nom du bucket S3, et paramétrer les IPs ou les ranges que l’on souhaite autoriser.</description></item></channel></rss>